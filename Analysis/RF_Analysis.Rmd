---
title: "RF Analysis"
author: "Julisa Lopez"
date: "1/10/2020"
output: html_document
---

```{r Packages} 
library(tidyverse)
library(abind)
library(foreach)
library(haven)
library(labelled)
library(psych)
library(multicon)
library(varhandle)
library(hablar)
library(haven)
library(tidyr)
library(lavaan)
library(dplyr)
library(here)
library(rio)
library(JSmediation)

# install.packages("lavaan")
# install.packages("tidyr")
# devtools::install_github("hadley/tidyverse")

```

```{r Study1 midpoint}
midpoint <- data.frame(midpoint = c(
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4))
```

```{r Study 2 midpoint}
midpoint2 <- data.frame(midpoint = c(
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4))
```

```{r Study 3 midpoint}
midpoint3 <- data.frame(midpoint = c(
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4))
```

```{r Study 4 midpoint}
midpoint4 <- data.frame(midpoint = c(
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4,4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
  4, 4, 4, 4, 4, 4
  ))
```

```{r Functions to center things }

center<-function(MOD)
{
  centered<-MOD-mean(MOD,na.rm=TRUE)
  return(centered)
}

low<-function(MOD)
{
  low<-(MOD-mean(MOD,na.rm=TRUE))+sd(MOD, na.rm=TRUE)
  return(low)
}

high<-function(MOD)
{
  high<-(MOD-mean(MOD, na.rm=TRUE))-sd(MOD, na.rm=TRUE)
  return(high)
}

gmc <- function(MOD, grp) 
  { 
  gmcentered<- (MOD-tapply(MOD,grp,mean,na.rm=TRUE)[grp])
  return(gmcentered)

}

```


Study 1A - T-Test between Redface and Blackface (Between Subjects)

```{r Study 1A - Load in Data}

# Load in dataset
Study1Arawdataset <- read.csv("C:/Users/Julisa/Documents/RFBF/RFBF.repo/Data/Study1A_Randomized.csv", header = T, sep = ",", na=-99, stringsAsFactors = FALSE)

# Delete extra row that qualtrics downloads
Study1Arawdataset<- Study1Arawdataset[-1, ]  

# Retyping data so replace empty cells with NAs
data <- Study1Arawdataset %>% retype()

# Creating target dummy variable
# Study1Arawdataset <- mutate(Study1Arawdataset, Condition = ifelse(is.na(Study1Arawdataset$Q43), 1, 0))

# Prepping by setting NA to 0 for Race variables 
data$Race_1[is.na(data$Race_1)] <- 0
data$Race_2[is.na(data$Race_2)] <- 0
data$Race_3[is.na(data$Race_3)] <- 0
data$Race_4[is.na(data$Race_4)] <- 0
data$Race_5[is.na(data$Race_5)] <- 0
data$Race_6[is.na(data$Race_6)] <- 0
data$Race_7[is.na(data$Race_7)] <- 0

# Creating Race variable 
data <- data %>% mutate(Race = case_when(
                    Race_1 == 1 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "1",
                    Race_1 == 0 & Race_2 == 1 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "2",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 1 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "3",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 1 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "4",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 1 & Race_6 == 0 & Race_7 == 0 ~ "5",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 1 & Race_7 == 0 ~ "6",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 1 ~ "7"))

# Filter by Finished survey & deleting first three rows, these were previews 
Study1Arawdataset <- data %>% filter(V10 == 1)

Study1Arawdataset <- Study1Arawdataset[-c(1:3), ]



```


```{r BF OK}

BF1a <- Study1Arawdataset %>% dplyr::select(
  Q112_1, Q112_2, Q112_3, Q112_4,
  Q113_1, Q113_2, Q113_3, Q113_4,
  Q116_1, Q116_2, Q116_3, Q116_4,
  Q136_1, Q136_2, Q136_3, Q136_4,
  Q163_1, Q163_2, Q163_3, Q163_4)

BF.All.Key = c(
  1, -1, 1, -1, 
  1, -1, 1, -1,
  1, -1, 1, -1,
  1, -1, 1, -1,
  1, -1, 1, -1)

BF1a.r <-
  reverse.code(BF.All.Key,
               BF1a,
               mini = 1,
               maxi = 7)

BF1a.df <- as.data.frame(BF1a.r)

BFman_1 <- dplyr::coalesce(BF1a.df$Q112_1, BF1a.df$Q163_1)
BFman_2 <- dplyr::coalesce(BF1a.df$`Q112_2-`, BF1a.df$`Q163_2-`)
BFman_3 <- dplyr::coalesce(BF1a.df$Q112_3, BF1a.df$Q163_3)
BFman_4 <- dplyr::coalesce(BF1a.df$`Q112_4-`, BF1a.df$`Q163_4-`)

BFwom_1 <- BF1a.df$Q113_1
BFwom_2 <- BF1a.df$`Q113_2-`
BFwom_3 <- BF1a.df$Q113_3
BFwom_4 <- BF1a.df$`Q113_4-`

BFgroup_1 <- dplyr::coalesce(BF1a.df$Q116_1, BF1a.df$Q136_1)
BFgroup_2 <- dplyr::coalesce(BF1a.df$`Q116_2-`, BF1a.df$`Q136_2-`)
BFgroup_3 <- dplyr::coalesce(BF1a.df$Q116_3, BF1a.df$Q136_3)
BFgroup_4 <- dplyr::coalesce(BF1a.df$`Q116_4-`, BF1a.df$`Q136_4-`)

BF1a.df <- data.frame(
  BFman_1, BFman_2, BFman_3, BFman_4,
  BFwom_1, BFwom_2, BFwom_3, BFwom_4,
  BFgroup_1, BFgroup_2, BFgroup_3, BFgroup_4
)

BF1aOK <-
  multicon::composite(BF1a.df,
  rel = TRUE, 
  nomiss = 0.6)

```


```{r RF OK}
RF1a <- Study1Arawdataset %>% dplyr::select(
  Q156_1, Q156_2, Q156_3, Q156_4,
  Q123_1, Q123_2, Q123_3, Q123_4,
  Q160_1, Q160_2, Q160_3, Q160_4,
  Q143_1, Q143_2, Q143_3, Q143_4,
  Q148_1, Q148_2, Q148_3, Q148_4)

RF1a.r <-
  reverse.code(BF.All.Key,
               RF1a,
               mini = 1,
               maxi = 7)

RF1a.df <- as.data.frame(RF1a.r)

RFman_1 <- dplyr::coalesce(RF1a.df$Q148_1, RF1a.df$Q123_1)
RFman_2 <- dplyr::coalesce(RF1a.df$`Q148_2-`, RF1a.df$`Q123_2-`)
RFman_3 <- dplyr::coalesce(RF1a.df$Q148_3, RF1a.df$Q123_3)
RFman_4 <- dplyr::coalesce(RF1a.df$`Q148_4-`, RF1a.df$`Q123_4-`)

RFwom_1 <- RF1a.df$Q160_1
RFwom_2 <- RF1a.df$`Q160_2-`
RFwom_3 <- RF1a.df$Q160_3
RFwom_4 <- RF1a.df$`Q160_4-`

RFgroup_1 <- dplyr::coalesce(RF1a.df$Q143_1, RF1a.df$Q156_1)
RFgroup_2 <- dplyr::coalesce(RF1a.df$`Q143_2-`, RF1a.df$`Q156_2-`)
RFgroup_3 <- dplyr::coalesce(RF1a.df$Q143_3, RF1a.df$Q156_3)
RFgroup_4 <- dplyr::coalesce(RF1a.df$`Q143_4-`, RF1a.df$`Q156_4-`)

RF1a.df <- data.frame(
  RFman_1, RFman_2, RFman_3, RFman_4,
  RFwom_1, RFwom_2, RFwom_3, RFwom_4,
  RFgroup_1, RFgroup_2, RFgroup_3, RFgroup_4
)

RF1aOK <-
  multicon::composite(RF1a.df,
  rel = TRUE, 
  nomiss = 0.6)

# RFPaintWom2_1 - Cleveland Indian Woman & BFPaintWom2_1 - Afro Woman
# write.csv(Study1Arawdataset, 'Study1A_W')
```


```{r T test}
t.test(BF1aOK, RF1aOK, paired = TRUE)
t.test(BF1aOK, midpoint, paired = FALSE)
t.test(RF1aOK, midpoint, paired = FALSE)
```

Study 1A - Demographics

```{r Demographics}
# N = 75

# Gender = 55.8%

table(Study1Arawdataset$Gender)

# Age = 19.02
Study1Arawdataset$Age[Study1Arawdataset$Age == "18 years"] <- 18
Age <- as.numeric(Study1Arawdataset$Age)
mean(Age, na.rm = TRUE)

# FGC Status (N = 52)
Edu1A <- Study1Arawdataset %>% filter(PrimaryEd >= 4 | SecondEdu >= 4)


# Race (43 = AA, 3 = Blk, 16 = White, 2 = Latino, 2 = Middle Eastern, 1 = Native)
table(Study1Arawdataset$Race)


```

Study 1A - Power analysis

```{r Power Analysis}
power.t.test(n = 77, delta = (mean(BF1aOK) - mean(RF1aOK, na.rm = TRUE)), sig.level = 0.05, power = NULL, type = "paired")

```

Study 1B - T-Test between Redface and Blackface (Between Subjects)

```{r Study 1B - Load in Data}

Study1Brawdataset <- read.csv("C:/Users/Julisa/Documents/RFBF/RFBF.repo/Data/Study1B_Randomized.csv", header = T, sep = ",", na=-99, stringsAsFactors = FALSE)

Study1Brawdataset<- Study1Brawdataset[-1, ]  

data <- Study1Brawdataset %>% retype()

# Prepping by setting NA to 0 for Race variables 
data$Race_1[is.na(data$Race_1)] <- 0
data$Race_2[is.na(data$Race_2)] <- 0
data$Race_3[is.na(data$Race_3)] <- 0
data$Race_4[is.na(data$Race_4)] <- 0
data$Race_5[is.na(data$Race_5)] <- 0
data$Race_6[is.na(data$Race_6)] <- 0
data$Race_7[is.na(data$Race_7)] <- 0

# Creating Race variable 
data <- data %>% mutate(Race = case_when(
                    Race_1 == 1 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "1",
                    Race_1 == 0 & Race_2 == 1 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "2",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 1 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "3",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 1 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "4",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 1 & Race_6 == 0 & Race_7 == 0 ~ "5",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 1 & Race_7 == 0 ~ "6",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 1 ~ "7"))

# Filter by Finished survey & deleting first three rows, these were previews 
Study1Brawdataset <- data %>% filter(V10 == 1)
```

```{r BF OK}
BF1b <- Study1Brawdataset %>% dplyr::select(
  BFPaint1_1, BFPaint1_2, BFPaint1_3, BFPaint1_4,
  BFPaintWom1_1, BFPaintWom1_2, BFPaintWom1_3, BFPaintWom1_4,
  BFGroup1_1, BFGroup1_2, BFGroup1_3, BFGroup1_4,
  BFPaintMan2_1, BFPaintMan2_2, BFPaintMan2_3, BFPaintMan2_4,
  BFGroup2_1, BFGroup2_2, BFGroup2_3, BFGroup2_4)

BF.All.Key = c(
  1, -1, 1, -1, 
  1, -1, 1, -1,
  1, -1, 1, -1,
  1, -1, 1, -1,
  1, -1, 1, -1)

BF1b.r <-
  reverse.code(BF.All.Key,
               BF1b,
               mini = 1,
               maxi = 7)

BF1b.df <- as.data.frame(BF1b.r)

BF1bman_1 <- dplyr::coalesce(BF1b.df$BFPaint1_1, BF1b.df$BFPaintMan2_1)
BF1bman_2 <- dplyr::coalesce(BF1b.df$`BFPaint1_2-`, BF1b.df$`BFPaintMan2_2-`)
BF1bman_3 <- dplyr::coalesce(BF1b.df$BFPaint1_3, BF1b.df$BFPaintMan2_3)
BF1bman_4 <- dplyr::coalesce(BF1b.df$`BFPaint1_4-`, BF1b.df$`BFPaintMan2_4-`)

BF1bwom_1 <- BF1b.df$BFPaintWom1_1
BF1bwom_2 <- BF1b.df$`BFPaintWom1_2-`
BF1bwom_3 <- BF1b.df$BFPaintWom1_3
BF1bwom_4 <- BF1b.df$`BFPaintWom1_4-`

BF1bgroup_1 <- dplyr::coalesce(BF1b.df$BFGroup1_1, BF1b.df$BFGroup2_1)
BF1bgroup_2 <- dplyr::coalesce(BF1b.df$`BFGroup1_2-`, BF1b.df$`BFGroup2_2-`)
BF1bgroup_3 <- dplyr::coalesce(BF1b.df$BFGroup1_3, BF1b.df$BFGroup2_3)
BF1bgroup_4 <- dplyr::coalesce(BF1b.df$`BFGroup1_4-`, BF1b.df$`BFGroup2_4-`)

BF1b.df <- data.frame(
  BF1bman_1, BF1bman_2, BF1bman_3, BF1bman_4,
  BF1bwom_1, BF1bwom_2, BF1bwom_3, BF1bwom_4,
  BF1bgroup_1, BF1bgroup_2, BF1bgroup_3, BF1bgroup_4
)

BF1bOK <-
  multicon::composite(BF1b.df,
  rel = TRUE, 
  nomiss = 0.6)
```

```{r RF OK}
RF1b <- Study1Brawdataset %>% dplyr::select(
  RFPaintGroup2_1, RFPaintGroup2_2, RFPaintGroup2_3, RFPaintGroup2_4,
  RFPaintWom1_1, RFPaintWom1_2, RFPaintWom1_3, RFPaintWom1_4,
  RFPaintGroup1_1, RFPaintGroup1_2, RFPaintGroup1_3, RFPaintGroup1_4,
  RFPaintMan2_1, RFPaintMan2_2, RFPaintMan2_3, RFPaintMan2_4,
  RFGroup2_1, RFGroup2_2, RFGroup2_3, RFGroup2_4)

RF1b.r <-
  reverse.code(BF.All.Key,
               RF1b,
               mini = 1,
               maxi = 7)

RF1b.df <- as.data.frame(RF1b.r)

RF1bman_1 <- dplyr::coalesce(RF1b.df$RFPaintGroup2_1, RF1b.df$RFPaintMan2_1)
RF1bman_2 <- dplyr::coalesce(RF1b.df$`RFPaintGroup2_2-`, RF1b.df$`RFPaintMan2_2-`)
RF1bman_3 <- dplyr::coalesce(RF1b.df$RFPaintGroup2_3, RF1b.df$RFPaintMan2_3)
RF1bman_4 <- dplyr::coalesce(RF1b.df$`RFPaintGroup2_4-`, RF1b.df$`RFPaintMan2_4-`)

RF1bwom_1 <- RF1b.df$RFPaintWom1_1
RF1bwom_2 <- RF1b.df$`RFPaintWom1_2-`
RF1bwom_3 <- RF1b.df$RFPaintWom1_3
RF1bwom_4 <- RF1b.df$`RFPaintWom1_4-`

RF1bgroup_1 <- dplyr::coalesce(RF1b.df$RFPaintGroup1_1, RF1b.df$RFGroup2_1)
RF1bgroup_2 <- dplyr::coalesce(RF1b.df$`RFPaintGroup1_2-`, RF1b.df$`RFGroup2_2-`)
RF1bgroup_3 <- dplyr::coalesce(RF1b.df$RFPaintGroup1_3, RF1b.df$RFGroup2_3)
RF1bgroup_4 <- dplyr::coalesce(RF1b.df$`RFPaintGroup1_4-`, RF1b.df$`RFGroup2_4-`)

RF1b.df <- data.frame(
  RF1bman_1, RF1bman_2, RF1bman_3, RF1bman_4,
  RF1bwom_1, RF1bwom_2, RF1bwom_3, RF1bwom_4,
  RF1bgroup_1, RF1bgroup_2, RF1bgroup_3, RF1bgroup_4
)

RF1bOK <-
  multicon::composite(RF1b.df,
  rel = TRUE, 
  nomiss = 0.6)
```

```{r T test}
t.test(BF1bOK, RF1bOK, paired = TRUE)
t.test(midpoint, BF1bOK, paired = FALSE)
t.test(midpoint, RF1bOK, paired = FALSE)
```

Study 1B - Demographics

```{r Demographics}
# N = 102

# Gender
table(Study1Brawdataset$Gender)

# Age
Study1Brawdataset$Age[Study1Brawdataset$Age == 1997] <- 22
Age <- as.numeric(Study1Brawdataset$Age)
mean(Age, na.rm = TRUE)

# FGC Status
Edu1B <- Study1Brawdataset %>% filter(PrimaryEd >= 4 | SecondEdu >= 4)

# Race
table(Study1Brawdataset$Race)
```

Study 1B - Power analysis

```{r Power Analysis}
power.t.test(n = 103, delta = (mean(BF1bOK, na.rm = TRUE) - mean(RF1bOK, na.rm = TRUE)), sig.level = 0.05, power = NULL, type = "paired")
```

Study 2

Prepping Data 
```{r Study 2 - Load in Data}

Study2rawdataset <- read.csv("C:/Users/Julisa/Documents/RFBF/RFBF.repo/Data/Study2.csv", header = T, sep = ",", na=-99, stringsAsFactors = FALSE)

Study2rawdataset<- Study2rawdataset[-1, ]  # Getting rid of unneccesary rows

Study2rawdataset <- Study2rawdataset %>% retype()

Study2rawdataset <- mutate(Study2rawdataset, Condition_S2 = ifelse(is.na(Study2rawdataset$BFPaint1), 1, 0)) # creating condition variable

data <- Study2rawdataset

# Prepping by setting NA to 0 for Race variables 
data$Race_1[is.na(data$Race_1)] <- 0
data$Race_2[is.na(data$Race_2)] <- 0
data$Race_3[is.na(data$Race_3)] <- 0
data$Race_4[is.na(data$Race_4)] <- 0
data$Race_5[is.na(data$Race_5)] <- 0
data$Race_6[is.na(data$Race_6)] <- 0
data$Race_7[is.na(data$Race_7)] <- 0

# Creating Race variable 
data <- data %>% mutate(Race = case_when(
                    Race_1 == 1 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "1",
                    Race_1 == 0 & Race_2 == 1 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "2",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 1 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "3",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 1 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "4",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 1 & Race_6 == 0 & Race_7 == 0 ~ "5",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 1 & Race_7 == 0 ~ "6",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 1 ~ "7"))

# Filter by Race
Study2rawdataset <- data %>% filter(Race == 3) 

# Filter out the not finished surveys 
Study2rawdataset <- Study2rawdataset %>% filter(V10 == 1)

```

```{r BF OK}
BFS2.raw <- Study2rawdataset %>% filter(Condition_S2 == 0) %>% dplyr::select(
  BFPaint1_1, BFPaint1_2, BFPaint1_3, BFPaint1_4,
  BFPaintWom1_1, BFPaintWom1_2, BFPaintWom1_3, BFPaintWom1_4,
  BFGroup1_1, BFGroup1_2, BFGroup1_3, BFGroup1_4,
  BFPaintMan2_1, BFPaintMan2_2, BFPaintMan2_3, BFPaintMan2_4,
  BFGroup2_1, BFGroup2_2, BFGroup2_3, BFGroup2_4
)

BF.Key = c(1, -1, 1, -1, 
           1, -1, 1, -1,
           1, -1, 1, -1,
           1, -1, 1, -1,
           1, -1, 1, -1) #Reverse Scoring Items

BFS2.r <-
  reverse.code(BF.Key,
               BFS2.raw,
               mini = 1,
               maxi = 7)

BFS2.comp <-
  multicon::composite(BFS2.r,
  rel = TRUE, 
  nomiss = 0.6)

BFS2.OK <- as.data.frame(BFS2.comp)

```

```{r RF OK}
RFS2.raw <- Study2rawdataset %>% filter(Condition_S2 == 1) %>% dplyr::select(
  RFPaintGroup2_1, RFPaintGroup2_2, RFPaintGroup2_3, RFPaintGroup2_4, 
  RFPaintWom1_1, RFPaintWom1_2, RFPaintWom1_3, RFPaintWom1_4, 
  RFPaintGroup1_1, RFPaintGroup1_2, RFPaintGroup1_3, RFPaintGroup1_4,
  RFPaintMan2_1, RFPaintMan2_2, RFPaintMan2_3, RFPaintMan2_4, 
  RFGroup2_1, RFGroup2_2, RFGroup2_3, RFGroup2_4
  )

RFS2.r <-
  reverse.code(BF.Key,
               RFS2.raw,
               mini = 1,
               maxi = 7)

RFS2.comp <-
  multicon::composite(RFS2.r,
  rel = TRUE, 
  nomiss = 0.6)

RFS2.OK <- as.data.frame(RFS2.comp)

```

T-test between RFOK and BFOK

```{r T test}
t.test(RFS2.OK, BFS2.OK, paired = FALSE, var.equal = TRUE)
t.test(midpoint2, BFS2.OK, paired = FALSE)
t.test(midpoint2, RFS2.OK, paired = FALSE)

```

Creating Acceptability Variable combining Redface and Blackface
```{r OK}
BFS2.fullraw <- Study2rawdataset %>% dplyr::select(
  BFPaint1_1, BFPaint1_2, BFPaint1_3, BFPaint1_4,
  BFPaintWom1_1, BFPaintWom1_2, BFPaintWom1_3, BFPaintWom1_4,
  BFGroup1_1, BFGroup1_2, BFGroup1_3, BFGroup1_4,
  BFPaintMan2_1, BFPaintMan2_2, BFPaintMan2_3, BFPaintMan2_4,
  BFGroup2_1, BFGroup2_2, BFGroup2_3, BFGroup2_4
)

BFS2.full <-
  reverse.code(BF.Key,
               BFS2.fullraw,
               mini = 1,
               maxi = 7)

BFS2.df <- as.data.frame(BFS2.full)

BFOK_S2 <-
  multicon::composite(BFS2.full,
  rel = TRUE, 
  nomiss = 0.6)

RFS2.fullraw <- Study2rawdataset %>% dplyr::select(
  RFPaintGroup2_1, RFPaintGroup2_2, RFPaintGroup2_3, RFPaintGroup2_4, 
  RFPaintWom1_1, RFPaintWom1_2, RFPaintWom1_3, RFPaintWom1_4, 
  RFPaintGroup1_1, RFPaintGroup1_2, RFPaintGroup1_3, RFPaintGroup1_4,
  RFPaintMan2_1, RFPaintMan2_2, RFPaintMan2_3, RFPaintMan2_4, 
  RFGroup2_1, RFGroup2_2, RFGroup2_3, RFGroup2_4
  )

RFS2.full <-
  reverse.code(BF.Key,
               RFS2.fullraw,
               mini = 1,
               maxi = 7)

RFS2.df <- as.data.frame(RFS2.full)

RFOK_S2 <-
  multicon::composite(RFS2.full,
  rel = TRUE, 
  nomiss = 0.6)

OK_S2 <- dplyr::coalesce(BFOK_S2, RFOK_S2)

```

Differences in Racism Minimization Predicting Difference in Acceptability

```{r RacismMini}
#BRM.2raw <- Study2rawdataset %>% dplyr::select(
#  RacismMini_1, RacismMini_2, RacismMini_3, RacismMini_4, 
#  RacismMini_5, RacismMini_6, RacismMini_7, RacismMini_8, 
# RacismMini_9, RacismMini_10)

BRM.2raw <- Study2rawdataset %>% dplyr::select(
  RacismMini_8, 
  RacismMini_9, RacismMini_10
)

# RM.key = c(1, -1, 1, -1, -1, -1, -1, 1, 1, 1)

# BRM.2r <- reverse.code(RM.key, BRM.2raw, mini = 1, max = 7)

BlkRM_S2 <-
  multicon::composite(BRM.2raw,
  rel = TRUE, 
  nomiss = 0.6)

BRM.2df <- as.data.frame(BlkRM_S2)

#NRM.2raw <- Study2rawdataset %>% dplyr::select(
 # RacismMini_1.1, RacismMini_2.1, RacismMini_3.1, RacismMini_4.1, 
 # RacismMini_5.1, RacismMini_6.1, RacismMini_7.1, RacismMini_8.1, 
 # RacismMini_9.1, RacismMini_10.1)

NRM.2raw <- Study2rawdataset %>% dplyr::select(
  RacismMini_8.1, 
  RacismMini_9.1, RacismMini_10.1)

# NRM.2r <- reverse.code(RM.key, NRM.2raw, mini = 1, max = 7)

NtvRM_S2 <-
  multicon::composite(NRM.2raw,
  rel = TRUE, 
  nomiss = 0.6)

NRM.2df <- as.data.frame(NtvRM_S2)

RM_S2 <- dplyr::coalesce(BlkRM_S2, NtvRM_S2)

t.test(NtvRM_S2, BlkRM_S2, paired = FALSE, var.equal = TRUE)

```

```{r Mediation}
X <- Study2rawdataset$Condition_S2
M <- RM_S2
Y <- OK_S2
Data <- data.frame(X=Study2rawdataset$Condition_S2, Y=OK_S2, M=RM_S2)

model <- ' # direct effect
             Y ~ c*X
           # mediator
             M ~ a*X
             Y ~ b*M
           # indirect effect (a*b)
             ab := a*b
           # total effect
             total := c + (a*b)
         '

fit <- sem(model, data = Data)
summary(fit)

```


Demographics

```{r Demographics}
# N = 148

# Gender Women = 57.6
table(Study2rawdataset$Gender)

# Age = 22.41
Study2rawdataset$Age[Study2rawdataset$Age == "18 years"] <- 18
Study2rawdataset$Age[Study2rawdataset$Age == "19 years"] <- 19
Age <- as.numeric(Study2rawdataset$Age)
mean(Age, na.rm = TRUE)

# FGC Status = 88.2%
Edu2 <- Study2rawdataset %>% filter(PrimaryEd >= 4 | SecondEdu >= 4)

```

```{r Study 3 - Load in Data}

Study3rawdataset <- read.csv("C:/Users/Julisa/Documents/RFBF/RFBF.repo/Data/Study3_Randomized.csv", header = T, sep = ",", na=-99, stringsAsFactors = FALSE)

Study3rawdataset<- Study3rawdataset[-1, ]  # Getting rid of unneccesary rows

Study3rawdataset <- Study3rawdataset %>% retype()

data <- Study3rawdataset

# Prepping by setting NA to 0 for Race variables 
data$Race_1[is.na(data$Race_1)] <- 0
data$Race_2[is.na(data$Race_2)] <- 0
data$Race_3[is.na(data$Race_3)] <- 0
data$Race_4[is.na(data$Race_4)] <- 0
data$Race_5[is.na(data$Race_5)] <- 0
data$Race_6[is.na(data$Race_6)] <- 0
data$Race_7[is.na(data$Race_7)] <- 0

# Creating Race variable 
data <- data %>% mutate(Race = case_when(
                    Race_1 == 1 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "1",
                    Race_1 == 0 & Race_2 == 1 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "2",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 1 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "3",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 1 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "4",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 1 & Race_6 == 0 & Race_7 == 0 ~ "5",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 1 & Race_7 == 0 ~ "6",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 1 ~ "7"))

# Filter by Race
Study3rawdataset <- data %>% filter(Race == 3) 

# Filter out the not finished surveys 
Study3rawdataset <- Study3rawdataset %>% filter(V10 == 1)

Study3rawdataset <- mutate(Study3rawdataset, Condition_S3 = ifelse(is.na(Study3rawdataset$B1_1), 1, 0)) # creating condition variable

```

```{r BF OK}
BFS3.raw <- Study3rawdataset %>% filter(Condition_S3 == 0) %>% dplyr::select(
  B1_1, B1_2, B1_3, B1_4,
  B2_1, B2_2, B2_3, B2_4,
  B3_1, B3_2, B3_3, B3_4,
  B5_1, B5_2, B5_3, B5_4,
  B6_1, B6_2, B6_3, B6_4
)

BF.Key = c(1, -1, 1, -1, 
           1, -1, 1, -1,
           1, -1, 1, -1,
           1, -1, 1, -1,
           1, -1, 1, -1) #Reverse Scoring Items

BFS3.r <-
  reverse.code(BF.Key,
               BFS3.raw,
               mini = 1,
               maxi = 7)

BFS3.OK <-
  multicon::composite(BFS3.r,
  rel = TRUE, 
  nomiss = 0.6)

```

```{r RF OK}
RFS3.raw <- Study3rawdataset %>% filter(Condition_S3 == 1) %>% dplyr::select(
  R1_1, R1_2, R1_3, R1_4, 
  R2_1, R2_2, R2_3, R2_4,
  R3_1, R3_2, R3_3, R3_4,
  R5_1, R5_2, R5_3, R5_4,
  R6_1, R6_2, R6_3, R6_4
  )

RFS3.r <-
  reverse.code(BF.Key,
               RFS3.raw,
               mini = 1,
               maxi = 7)

RFS3.comp <-
  multicon::composite(RFS3.r,
  rel = TRUE, 
  nomiss = 0.6)

RFS3.OK <- as.data.frame(RFS3.comp)

```

T-test between RFOK and BFOK

```{r T test}
t.test(RFS3.OK, BFS3.OK, paired = FALSE, var.equal = TRUE)
t.test(midpoint3, BFS3.OK, paired = FALSE)
t.test(midpoint3, RFS3.OK, paired = FALSE)

t.test(BRM.3, NRM.3, paired = FALSE, var.equal = TRUE)

```

Creating Acceptability Variable combining Redface and Blackface
```{r OK}
BFS3.fullraw <- Study3rawdataset %>% dplyr::select(
  B1_1, B1_2, B1_3, B1_4,
  B2_1, B2_2, B2_3, B2_4,
  B3_1, B3_2, B3_3, B3_4,
  B5_1, B5_2, B5_3, B5_4,
  B6_1, B6_2, B6_3, B6_4
)

BFS3.full <-
  reverse.code(BF.Key,
               BFS3.fullraw,
               mini = 1,
               maxi = 7)

BFS3.df <- as.data.frame(BFS3.full)

BFOK_S3 <-
  multicon::composite(BFS3.full,
  rel = TRUE, 
  nomiss = 0.6)

RFS3.fullraw <- Study3rawdataset %>% dplyr::select(
  R1_1, R1_2, R1_3, R1_4, 
  R2_1, R2_2, R2_3, R2_4,
  R3_1, R3_2, R3_3, R3_4,
  R5_1, R5_2, R5_3, R5_4,
  R6_1, R6_2, R6_3, R6_4
  )

RFS3.full <-
  reverse.code(BF.Key,
               RFS3.fullraw,
               mini = 1,
               maxi = 7)

RFS3.df <- as.data.frame(RFS3.full)

RFOK_S3 <- 
  multicon::composite(RFS3.full,
                      rel = TRUE,
                      nomiss = 0.6)

OK_S3 <- dplyr::coalesce(BFOK_S3, RFOK_S3)

```

Differences in Racism Minimization Predicting Difference in Acceptability

```{r RacismMini}
# BRM.3raw <- Study3rawdataset %>% dplyr::select(
# BlkRacismMini_1, BlkRacismMini_2, BlkRacismMini_3, # BlkRacismMini_4, BlkRacismMini_5, BlkRacismMini_6, # BlkRacismMini_7, BlkRacismMini_8, BlkRacismMini_9, # BlkRacismMini_10)

BRM.3raw <- Study3rawdataset %>% dplyr::select(
  BlkRacismMini_8, BlkRacismMini_9, BlkRacismMini_10)

# BRM.3r <- reverse.code(RM.3key, BRM.3raw, mini = 1, max = 7)

BRM.3 <- multicon::composite(BRM.3raw,
  rel = TRUE, 
  nomiss = 0.6)

BRM.3df <- as.data.frame(BRM.3raw)

#NRM.3raw <- Study3rawdataset %>% dplyr::select(
# NtvRacismMini_1, NtvRacismMini_2, NtvRacismMini_3, # BtvRacismMini_4, NtvRacismMini_5, NtvRacismMini_6, # NtvRacismMini_7, NtvRacismMini_8, NtvRacismMini_9, # NtvRacismMini_10)

NRM.3raw <- Study3rawdataset %>% dplyr::select(
  NtvRacismMini_8, NtvRacismMini_9, NtvRacismMini_10)

# NRM.3r <- reverse.code(RM.3key, NRM.3raw, mini = 1, max = 7)

NRM.3 <- multicon::composite(NRM.3raw,
  rel = TRUE, 
  nomiss = 0.6)

NRM.3df <- as.data.frame(NRM.3raw)

RM_S3 <- dplyr::coalesce(BRM.3, NRM.3)

t.test(NRM.3, BRM.3, paired = FALSE, var.equal = TRUE)

```

```{r Invisibility}
BIN.3raw <- Study3rawdataset %>% dplyr::select(
  BlkContemporaryInvis_1, BlkContemporaryInvis_2, BlkContemporaryInvis_3,
  BlkContemporaryInvis_4, BlkContemporaryInvis_5, BlkContemporaryInvis_6
  )

IN.3key = c(1, -1, 1, 1, 1, 1)

BIN.3r <- reverse.code(IN.3key,
                      BIN.3raw,
                      mini = 1,
                      max = 7)

BIN.3df <- as.data.frame(BIN.3r)

BIN_S3 <- multicon::composite(BIN.3r,
  rel = TRUE, 
  nomiss = 0.6)

NIN.3raw <- Study3rawdataset %>% dplyr::select(
  NtvContemporaryInvis_1, NtvContemporaryInvis_2, NtvContemporaryInvis_3,
  NtvContemporaryInvis_4, NtvContemporaryInvis_5, NtvContemporaryInvis_6)

NIN.3r <- reverse.code(IN.3key,
                      NIN.3raw,
                      mini = 1,
                      max = 7)

NIN.3df <- as.data.frame(NIN.3r)

NIN_S3 <- multicon::composite(NIN.3r,
  rel = TRUE, 
  nomiss = 0.6)

IN_S3 <- dplyr::coalesce(BIN_S3, NIN_S3)

```

```{r Serial Mediation}
X <- Study3rawdataset$Condition_S3
M1 <- IN_S3
M2 <- RM_S3
Y <- OK_S3
Data <- data.frame(X=Study3rawdataset$Condition_S3, Y=OK_S3, M1=IN_S3, M2=RM_S3)

multipleMediation <- '
    Y ~ b1 * M1 + b2 * M2 + c * X
    M1 ~ a1 * X
    M2 ~ a2 * X
    indirect1 := a1 * b1
    indirect2 := a2 * b2
    total    := c + (a1 * b1) + (a2 * b2)
    M1 ~~ M2 
'
fit <- sem(model = multipleMediation, data = Data)
summary(fit)  

```

Demographics

```{r Demographics}
# N = 648

# Gender Women = 48.2
table(Study3rawdataset$Gender)

# Age = 22.41
Study3rawdataset$Age[Study3rawdataset$Age == "28`"] <- 28
Study3rawdataset$Age[Study3rawdataset$Age == "39*"] <- 39
Age <- as.numeric(Study3rawdataset$Age)
mean(Age, na.rm = TRUE)

# FGC Status = 88.2%
Edu3 <- Study3rawdataset %>% filter(PrimaryEd >= 4 | SecondEdu >= 4)

```


```{r Study 4 - Load in Data}

Study4rawdataset <- read.csv("C:/Users/Julisa/Documents/RFBF/RFBF.repo/Data/Study4_Randomized.csv", header = T, sep = ",", na=-99, stringsAsFactors = FALSE)

Study4rawdataset<- Study4rawdataset[-1, ]  # Getting rid of unneccesary rows

Study4rawdataset <- Study4rawdataset %>% retype()

data <- Study4rawdataset

# Prepping by setting NA to 0 for Race variables 
data$Race_1[is.na(data$Race_1)] <- 0
data$Race_2[is.na(data$Race_2)] <- 0
data$Race_3[is.na(data$Race_3)] <- 0
data$Race_4[is.na(data$Race_4)] <- 0
data$Race_5[is.na(data$Race_5)] <- 0
data$Race_6[is.na(data$Race_6)] <- 0
data$Race_7[is.na(data$Race_7)] <- 0

# Creating Race variable 
data <- data %>% mutate(Race = case_when(
                    Race_1 == 1 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "1",
                    Race_1 == 0 & Race_2 == 1 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "2",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 1 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "3",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 1 & Race_5 == 0 & Race_6 == 0 & Race_7 == 0 ~ "4",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 1 & Race_6 == 0 & Race_7 == 0 ~ "5",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 1 & Race_7 == 0 ~ "6",
                    Race_1 == 0 & Race_2 == 0 & Race_3 == 0 & Race_4 == 0 & Race_5 == 0 & Race_6 == 0 & Race_7 == 1 ~ "7"))

# Filter by Race
Study4rawdataset <- data %>% filter(Race == 3) 

# Filter out the not finished surveys 
Study4rawdataset <- Study4rawdataset %>% filter(V10 == 1)

```

```{r BF OK}
BFS4.raw <- Study4rawdataset %>% dplyr::select(
  B1_1, B1_2, B1_3, B1_4,
  B2_1, B2_2, B2_3, B2_4,
  B3_1, B3_2, B3_3, B3_4)

BF.4Key = c(1, -1, 1, -1, 
           1, -1, 1, -1,
           1, -1, 1, -1) #Reverse Scoring Items

BFS4.r <-
  reverse.code(BF.4Key,
               BFS4.raw,
               mini = 1,
               maxi = 7)

BFS4.comp <-
  multicon::composite(BFS4.r,
  rel = TRUE, 
  nomiss = 0.6)

BFS4.OK <- as.data.frame(BFS4.comp)

```

```{r RF OK}
RFS4.raw <- Study4rawdataset %>% dplyr::select(
  R1_1, R1_2, R1_3, R1_4, 
  R2_1, R2_2, R2_3, R2_4,
  R3_1, R3_2, R3_3, R3_4)

RFS4.r <-
  reverse.code(BF.4Key,
               RFS4.raw,
               mini = 1,
               maxi = 7)

RFS4.comp <-
  multicon::composite(RFS4.r,
  rel = TRUE, 
  nomiss = 0.6)

RFS4.OK <- as.data.frame(RFS4.comp)

```

T-test between RFOK and BFOK

```{r T test}
t.test(RFS4.comp, BFS4.comp, paired = TRUE)
t.test(midpoint4, BFS4.comp, paired = FALSE)
t.test(midpoint4, RFS4.comp, paired = FALSE)
```

```{r RacismMini}
#BRM.4raw <- Study4rawdataset %>% dplyr::select(
#  BlkRacismMini_1, BlkRacismMini_2, BlkRacismMini_3, BlkRacismMini_4, 
#  BlkRacismMini_5, BlkRacismMini_6, BlkRacismMini_7, BlkRacismMini_8, 
#  BlkRacismMini_9, BlkRacismMini_10
#)

BRM.4raw <- Study4rawdataset %>% dplyr::select(
  BlkRacismMini_8, BlkRacismMini_9, BlkRacismMini_10
)

RM.4key = c(1,
           1, 1
           )

BRM.4r <- reverse.code(RM.4key,
                      BRM.4raw,
                      mini = 1,
                      max = 7)

BRM_S4 <- multicon::composite(BRM.4r,
  rel = TRUE, 
  nomiss = 0.6)

BRM.4df <- as.data.frame(BRM_S4)

#NRM.4raw <- Study4rawdataset %>% dplyr::select(
 # NtvRacismMini_1, NtvRacismMini_2, NtvRacismMini_3, NtvRacismMini_4, 
 # NtvRacismMini_5, NtvRacismMini_6, NtvRacismMini_7, NtvRacismMini_8, 
 # NtvRacismMini_9, NtvRacismMini_10
#)

NRM.4raw <- Study4rawdataset %>% dplyr::select(
  NtvRacismMini_8, 
  NtvRacismMini_9, NtvRacismMini_10
)

NRM.4r <- reverse.code(RM.4key,
                      NRM.4raw,
                      mini = 1,
                      max = 7)

NRM_S4 <- multicon::composite(NRM.4r,
  rel = TRUE, 
  nomiss = 0.6)

NRM.4df <- as.data.frame(NRM_S4)

t.test(NRM_S4, BRM_S4, paired = TRUE)

```

```{r Invisibility}
BIN.4raw <- Study4rawdataset %>% dplyr::select(
  BlkContemporaryInvis_1, BlkContemporaryInvis_2, BlkContemporaryInvis_3,
  BlkContemporaryInvis_4, BlkContemporaryInvis_5, BlkContemporaryInvis_6
  )

IN.4key = c(1, -1, 1, 
            1, 1, 1)

BIN.4r <- reverse.code(IN.4key,
                      BIN.4raw,
                      mini = 1,
                      max = 7)

BIN_S4 <- multicon::composite(BIN.4r,
  rel = TRUE, 
  nomiss = 0.6)

BIN.4df <- as.data.frame(BIN_S4)

NIN.4raw <- Study4rawdataset %>% dplyr::select(
  NtvContemporaryInvis_1, NtvContemporaryInvis_2, NtvContemporaryInvis_3,
  NtvContemporaryInvis_4, NtvContemporaryInvis_5, NtvContemporaryInvis_6)

NIN.4r <- reverse.code(IN.4key,
                      NIN.4raw,
                      mini = 1,
                      max = 7)

NIN_S4 <- multicon::composite(NIN.4r,
  rel = TRUE, 
  nomiss = 0.6)

NIN.4df <- as.data.frame(NIN_S4)

```

```{r N Linear Regression OK~RM}
table1::table1(~NRM.4df BRM.4df| ReservationExperience, data=MascotDataNative)
```

```{r}
vars <- data.frame(RFS4.comp, BFS4.comp, BRM_S4, NRM_S4, NIN_S4, BIN_S4)

mediation_model <- mdt_within_wide(vars, DV_A = RFS4.comp, DV_B = BFS4.comp, M_A = NIN_S4, M_B = BIN_S4)

mediation_model$paths

add_index(mediation_model, times = 5000, level = 0.05)
```



```{r Mediation}

X <- Study3rawdataset$Condition_S3
M1 <- IN_S3
M2 <- RM_S3
Y <- OK_S3
Data <- data.frame(X=Study3rawdataset$Condition_S3, Y=OK_S3, M1=IN_S3, M2=RM_S3)

multipleMediation <- '
    Y ~ b1 * M1 + b2 * M2 + c * X
    M1 ~ a1 * X
    M2 ~ a2 * X
    indirect1 := a1 * b1
    indirect2 := a2 * b2
    total    := c + (a1 * b1) + (a2 * b2)
    M1 ~~ M2 
'
fit <- sem(model = multipleMediation, data = Data)
summary(fit)  

```

Demographics

```{r Demographics}
# N = 774

# Gender Women = 57.6
table(Study4rawdataset$Gender)

# Age = 22.41
Study4rawdataset$Age[Study4rawdataset$Age == 445] <- 45
Study4rawdataset$Age[Study4rawdataset$Age == 1959] <- 60
Study4rawdataset$Age[Study4rawdataset$Age == 1995] <- 24
Age <- as.numeric(Study4rawdataset$Age)
mean(Age, na.rm = TRUE)


# FGC Status = 88.2%
Edu4 <- Study4rawdataset %>% filter(PrimaryEd >= 4 | SecondEdu >= 4)

```
