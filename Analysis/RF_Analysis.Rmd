---
title: "RF Analysis"
author: "Julisa Lopez"
date: "1/10/2020"
output: html_document
---

```{r Packages} 
library(tidyverse)
library(abind)
library(foreach)
library(haven)
library(labelled)
library(psych)
library(multicon)
library(varhandle)
library(hablar)
library(haven)
library(tidyr)
library(lavaan)

install.packages("lavaan")
# install.packages("tidyr")
# devtools::install_github("hadley/tidyverse")

```

Study 1A - T-Test between Redface and Blackface (Between Subjects)

```{r Study 1A - Load in Data}

# imac
# Study1Arawdataset <- read.csv("/Users/jujlopez/Documents/Redface/Data/Study1A.csv", header = T, sep = ",", na=-99, stringsAsFactors = FALSE)

# laptop
Study1Arawdataset <- read.csv("C:/Users/Julisa/Documents/RFBF/RFBF.repo/Data/Study1A.csv", header = T, sep = ",", na=-99, stringsAsFactors = FALSE)

Study1Arawdataset<- Study1Arawdataset[-c(1:10), ]  

Study1Arawdataset <- Study1Arawdataset %>% retype()

# Study1Arawdataset <- mutate(Study1Arawdataset, Condition = ifelse(is.na(Study1Arawdataset$Q43), 1, 0))

```

```{r BF OK}

BF1a <- Study1Arawdataset %>% dplyr::select(
  Q112_1, Q112_2, Q112_3, Q112_4,
  Q113_1, Q113_2, Q113_3, Q113_4,
  Q116_1, Q116_2, Q116_3, Q116_4,
  Q136_1, Q136_2, Q136_3, Q136_4,
  Q163_1, Q163_2, Q163_3, Q163_4)

BF.All.Key = c(
  1, -1, 1, -1, 
  1, -1, 1, -1,
  1, -1, 1, -1,
  1, -1, 1, -1,
  1, -1, 1, -1)

BF1a.r <-
  reverse.code(BF.All.Key,
               BF1a,
               mini = 1,
               maxi = 7)

BF1a.df <- as.data.frame(BF1a.r)

BF1aOK <- rowMeans(BF1a.df, na.rm = TRUE)

```


```{r RF OK}
RF1a <- Study1Arawdataset %>% dplyr::select(
  Q156_1, Q156_2, Q156_3, Q156_4,
  Q123_1, Q123_2, Q123_3, Q123_4,
  Q160_1, Q160_2, Q160_3, Q160_4,
  Q143_1, Q143_2, Q143_3, Q143_4,
  Q148_1, Q148_2, Q148_3, Q148_4)

RF1a.r <-
  reverse.code(BF.All.Key,
               RF1a,
               mini = 1,
               maxi = 7)

RF1a.df <- as.data.frame(RF1a.r)

RF1aOK <- rowMeans(RF1a.df, na.rm = TRUE)

# RFPaintWom2_1 - Cleveland Indian Woman & BFPaintWom2_1 - Afro Woman

Study1Arawdataset <- mutate(Study1Arawdataset, RF1aOK = rowMeans(RF1a.df, na.rm = TRUE))
Study1Arawdataset <- mutate(Study1Arawdataset, BF1aOK = rowMeans(BF1a.df, na.rm = TRUE))

# write.csv(Study1Arawdataset, 'Study1A_W')
```


```{r T test}
t.test(BF1aOK, RF1aOK, paired = TRUE)

mean(BF1aOK, na.rm = TRUE) 
sd(BF1aOK, na.rm = TRUE) 
mean(RF1aOK, na.rm = TRUE)
sd(RF1aOK, na.rm = TRUE)

```

Study 1A - Demographics

```{r Demographics}
# N = 77

# Gender = 55.8%

table(Study1Arawdataset$Gender)

# Age = 19.02
table(Study1Arawdataset$Age)

# FGC Status (N = 52)
Edu1A <- Study1Arawdataset %>% filter(PrimaryEd >= 4 | SecondEdu >= 4)

```

Study 1A - Power analysis

```{r Power Analysis}
power.t.test(n = 77, delta = (mean(BF1aOK) - mean(RF1aOK, na.rm = TRUE)), sig.level = 0.05, power = NULL, type = "paired")

```

Study 1B - T-Test between Redface and Blackface (Between Subjects)

```{r Study 1B - Load in Data}

#imac
# Study1Brawdataset <- read.csv("/Users/jujlopez/Documents/Redface/Data/Study1B.csv", header = T, sep = ",", na=-99, stringsAsFactors = FALSE)

# laptop
Study1Brawdataset <- read.csv("C:/Users/Julisa/Documents/RFBF/RFBF.repo/Data/Study1B.csv", header = T, sep = ",", na=-99, stringsAsFactors = FALSE)

Study1Brawdataset<- Study1Brawdataset[-c(1:2), ]  

Study1Brawdataset <- Study1Brawdataset %>% retype()
```

```{r BF OK}
BF1b <- Study1Brawdataset %>% dplyr::select(
  BFPaint1_1, BFPaint1_2, BFPaint1_3, BFPaint1_4,
  BFPaintWom1_1, BFPaintWom1_2, BFPaintWom1_3, BFPaintWom1_4,
  BFGroup1_1, BFGroup1_2, BFGroup1_3, BFGroup1_4,
  BFPaintMan2_1, BFPaintMan2_2, BFPaintMan2_3, BFPaintMan2_4,
  BFGroup2_1, BFGroup2_2, BFGroup2_3, BFGroup2_4)

BF1b.r <-
  reverse.code(BF.All.Key,
               BF1b,
               mini = 1,
               maxi = 7)

BF1b.df <- as.data.frame(BF1b.r)

BF1bOK <- rowMeans(BF1b.df, na.rm = TRUE)
```

```{r RF OK}
RF1b <- Study1Brawdataset %>% dplyr::select(
  RFPaintGroup2_1, RFPaintGroup2_2, RFPaintGroup2_3, RFPaintGroup2_4,
  RFPaintWom1_1, RFPaintWom1_2, RFPaintWom1_3, RFPaintWom1_4,
  RFPaintGroup1_1, RFPaintGroup1_2, RFPaintGroup1_3, RFPaintGroup1_4,
  RFPaintMan2_1, RFPaintMan2_2, RFPaintMan2_3, RFPaintMan2_4,
  RFGroup2_1, RFGroup2_2, RFGroup2_3, RFGroup2_4)

RF1b.r <-
  reverse.code(BF.All.Key,
               RF1b,
               mini = 1,
               maxi = 7)

RF1b.df <- as.data.frame(RF1b.r)

RF1bOK <- rowMeans(RF1b.df, na.rm = TRUE)
```

```{r T test}
t.test(BF1bOK, RF1bOK, paired = TRUE)

mean(BF1bOK, na.rm = TRUE)
sd(BF1bOK, na.rm = TRUE)
mean(RF1bOK, na.rm = TRUE)
sd(RF1bOK, na.rm = TRUE)

```

Study 1B - Demographics

```{r Demographics}
# N = 103

# Gender
table(Study1Brawdataset$Gender)

# Age
table(Study1Brawdataset$Age)

# FGC Status
Edu1B <- Study1Brawdataset %>% filter(PrimaryEd >= 4 | SecondEdu >= 4)
```

Study 1B - Power analysis

```{r Power Analysis}
power.t.test(n = 103, delta = (mean(BF1bOK, na.rm = TRUE) - mean(RF1bOK, na.rm = TRUE)), sig.level = 0.05, power = NULL, type = "paired")
```

Study 2

Prepping Data 
```{r Study 2 - Load in Data}

# imac
# Study2rawdataset <- read.csv("/Users/jujlopez/Documents/Redface/Data/Study2.csv", header = T, sep = ",", na=-99, stringsAsFactors = FALSE)

#laptop
Study2rawdataset <- read.csv("C:/Users/Julisa/Documents/RFBF/RFBF.repo/Data/Study2.csv", header = T, sep = ",", na=-99, stringsAsFactors = FALSE)

Study2rawdataset<- Study2rawdataset[-c(1:2), ]  # Getting rid of unneccesary rows

Study2rawdataset <- Study2rawdataset %>% retype()

Study2rawdataset <- mutate(Study2rawdataset, Condition = ifelse(is.na(Study2rawdataset$BFPaint1), 1, 0)) # creating condition variable

```

```{r BF OK}
BFS2.raw <- Study2rawdataset %>% filter(Condition == 0) %>% dplyr::select(
  BFPaint1_1, BFPaint1_2, BFPaint1_3, BFPaint1_4,
  BFPaintWom1_1, BFPaintWom1_2, BFPaintWom1_3, BFPaintWom1_4,
  BFGroup1_1, BFGroup1_2, BFGroup1_3, BFGroup1_4,
  BFPaintMan2_1, BFPaintMan2_2, BFPaintMan2_3, BFPaintMan2_4,
  BFGroup2_1, BFGroup2_2, BFGroup2_3, BFGroup2_4
)

BF.Key = c(1, -1, 1, -1, 
           1, -1, 1, -1,
           1, -1, 1, -1,
           1, -1, 1, -1,
           1, -1, 1, -1) #Reverse Scoring Items

BFS2.r <-
  reverse.code(BF.Key,
               BFS2.raw,
               mini = 1,
               maxi = 7)

BFS2.comp <-
  multicon::composite(BFS2.r,
  rel = TRUE, 
  nomiss = 0.6)

BFS2.OK <- as.data.frame(BFS2.comp)

```

```{r RF OK}
RFS2.raw <- Study2rawdataset %>% filter(Condition == 1) %>% dplyr::select(
  RFPaintGroup2_1, RFPaintGroup2_2, RFPaintGroup2_3, RFPaintGroup2_4, 
  RFPaintWom1_1, RFPaintWom1_2, RFPaintWom1_3, RFPaintWom1_4, 
  RFPaintGroup1_1, RFPaintGroup1_2, RFPaintGroup1_3, RFPaintGroup1_4,
  RFPaintMan2_1, RFPaintMan2_2, RFPaintMan2_3, RFPaintMan2_4, 
  RFGroup2_1, RFGroup2_2, RFGroup2_3, RFGroup2_4
  )

RFS2.r <-
  reverse.code(BF.Key,
               RFS2.raw,
               mini = 1,
               maxi = 7)

RFS2.comp <-
  multicon::composite(RFS2.r,
  rel = TRUE, 
  nomiss = 0.6)

RFS2.OK <- as.data.frame(RFS2.comp)

```

T-test between RFOK and BFOK

```{r T test}
t.test(RFS2.OK, BFS2.OK, paired = FALSE)

mean(RFS2.comp, na.rm = TRUE)
sd(RFS2.comp, na.rm = TRUE)
mean(BFS2.comp, na.rm = TRUE)
sd(BFS2.comp, na.rm = TRUE)
```

Creating Acceptability Variable combining Redface and Blackface
```{r OK}
BFS2.fullraw <- Study2rawdataset %>% dplyr::select(
  BFPaint1_1, BFPaint1_2, BFPaint1_3, BFPaint1_4,
  BFPaintWom1_1, BFPaintWom1_2, BFPaintWom1_3, BFPaintWom1_4,
  BFGroup1_1, BFGroup1_2, BFGroup1_3, BFGroup1_4,
  BFPaintMan2_1, BFPaintMan2_2, BFPaintMan2_3, BFPaintMan2_4,
  BFGroup2_1, BFGroup2_2, BFGroup2_3, BFGroup2_4
)

BFS2.full <-
  reverse.code(BF.Key,
               BFS2.fullraw,
               mini = 1,
               maxi = 7)

BFS2.full.comp <- rowMeans(BFS2.full, na.rm = TRUE)

# view(BFS2.full.comp)

RFS2.fullraw <- Study2rawdataset %>% dplyr::select(
  RFPaintGroup2_1, RFPaintGroup2_2, RFPaintGroup2_3, RFPaintGroup2_4, 
  RFPaintWom1_1, RFPaintWom1_2, RFPaintWom1_3, RFPaintWom1_4, 
  RFPaintGroup1_1, RFPaintGroup1_2, RFPaintGroup1_3, RFPaintGroup1_4,
  RFPaintMan2_1, RFPaintMan2_2, RFPaintMan2_3, RFPaintMan2_4, 
  RFGroup2_1, RFGroup2_2, RFGroup2_3, RFGroup2_4
  )

RFS2.full <-
  reverse.code(BF.Key,
               RFS2.fullraw,
               mini = 1,
               maxi = 7)

RFS2.full.comp <- rowMeans(RFS2.full, na.rm = TRUE)

Study2rawdataset <- Study2rawdataset %>% mutate(RFS2.full.comp = rowMeans(RFS2.full, na.rm = TRUE))
Study2rawdataset <- Study2rawdataset %>% mutate(BFS2.full.comp = rowMeans(BFS2.full, na.rm = TRUE))

Study2rawdataset$RFS2.full.comp[is.nan(Study2rawdataset$RFS2.full.comp)] <- NA

Study2rawdataset$BFS2.full.comp[is.nan(Study2rawdataset$BFS2.full.comp)] <- NA

Study2rawdataset <- Study2rawdataset %>% mutate_at(vars(RFS2.full.comp:BFS2.full.comp), as.character) %>% tidyr::unite(OK, RFS2.full.comp:BFS2.full.comp, na.rm = TRUE, remove = FALSE)

Study2rawdataset$OK <- as.numeric(Study2rawdataset$OK)

sd(Study2rawdataset$OK)

```


Differences in Racism Minimization Predicting Difference in Acceptability

```{r Black RM}
BRM.raw <- Study2rawdataset %>% dplyr::select(
  RacismMini_1, RacismMini_2, RacismMini_3, RacismMini_4, 
  RacismMini_5, RacismMini_6, RacismMini_7, RacismMini_8, 
  RacismMini_9, RacismMini_10
)

RM.key = c(1, -1, 1, -1, 
           -1, -1, -1, 1,
           1, 1
           )

BRM.r <- reverse.code(RM.key,
                      BRM.raw,
                      mini = 1,
                      max = 7)

# BRM.df <- as.data.frame(BRM.comp)
```

```{r Native RM}
NRM.raw <- Study2rawdataset %>% dplyr::select(
  RacismMini_1.1, RacismMini_2.1, RacismMini_3.1, RacismMini_4.1, 
  RacismMini_5.1, RacismMini_6.1, RacismMini_7.1, RacismMini_8.1, 
  RacismMini_9.1, RacismMini_10.1
)

NRM.r <- reverse.code(RM.key,
                      NRM.raw,
                      mini = 1,
                      max = 7)

# NRM.df <- as.data.frame(NRM.comp)

```

```{r}
Study2rawdataset <- Study2rawdataset %>% mutate(NRM.comp = multicon::composite(NRM.r, rel = TRUE, nomiss = 0.6))
Study2rawdataset <- Study2rawdataset %>% mutate(BRM.comp = multicon::composite(BRM.r, rel = TRUE, nomiss = 0.6))

Study2rawdataset$NRM.comp[is.nan(Study2rawdataset$NRM.comp)] <- NA

Study2rawdataset$BRM.comp[is.nan(Study2rawdataset$BRM.comp)] <- NA

Study2rawdataset <- Study2rawdataset %>% mutate_at(vars(NRM.comp:BRM.comp), as.character) %>% tidyr::unite(RM, NRM.comp:BRM.comp, na.rm = TRUE, remove = FALSE)

Study2rawdataset$RM <- as.numeric(Study2rawdataset$RM)
```

```{r Mediation}
X <- Study2rawdataset$Condition
M <- Study2rawdataset$RM
Y <- Study2rawdataset$OK
Data <- data.frame(X=X, Y=Y, M=M)

model <- ' # direct effect
             Y ~ c*X
           # mediator
             M ~ a*X
             Y ~ b*M
           # indirect effect (a*b)
             ab := a*b
           # total effect
             total := c + (a*b)
         '

fit <- sem(model, data = Data)
summary(fit)

```


Demographics

```{r Demographics}
# N = 170

# Gender Women = 57.6
table(Study2rawdataset$Gender)

# Age = 22.41
table(Study2rawdataset$Age)

# FGC Status = 88.2%
Edu2 <- Study2rawdataset %>% filter(PrimaryEd >= 4 | SecondEdu >= 4)

```

```{r}

```

